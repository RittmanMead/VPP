(function(){var t,e=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1},r=[].slice,n=function(t,e){return function(){return t.apply(e,arguments)}},a={}.hasOwnProperty;(t=function(t){return"object"==typeof exports&&"object"==typeof module?t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(t){var i,s,o,l,u,c,p,d,h,f,v,g,m,b,A,y,C,x;return s=function(t,e,r){var n,a,i,s;for(t+="",a=t.split("."),i=a[0],s=a.length>1?r+a[1]:"",n=/(\d+)(\d{3})/;n.test(i);)i=i.replace(n,"$1"+e+"$2");return i+s},v=function(e){var r;return r={digitsAfterDecimal:2,scaler:1,thousandsSep:",",decimalSep:".",prefix:"",suffix:"",showZero:!1},e=t.extend(r,e),function(t){var r;return isNaN(t)||!isFinite(t)?"":0!==t||e.showZero?(r=s((e.scaler*t).toFixed(e.digitsAfterDecimal),e.thousandsSep,e.decimalSep),""+e.prefix+r+e.suffix):""}},A=v(),y=v({digitsAfterDecimal:0}),C=v({digitsAfterDecimal:1,scaler:100,suffix:"%"}),o={count:function(t){return null==t&&(t=y),function(){return function(){return{count:0,push:function(){return this.count++},value:function(){return this.count},format:t}}}},countUnique:function(t){return null==t&&(t=y),function(r){var n;return n=r,function(){return{uniq:[],push:function(t){var r;return r=t[n],e.call(this.uniq,r)<0?this.uniq.push(t[n]):void 0},value:function(){return this.uniq.length},format:t,numInputs:null!=n?0:1}}}},listUnique:function(t){return function(r){var n;return n=r,function(){return{uniq:[],push:function(t){var r;return r=t[n],e.call(this.uniq,r)<0?this.uniq.push(t[n]):void 0},value:function(){return this.uniq.join(t)},format:function(t){return t},numInputs:null!=n?0:1}}}},sum:function(t){return null==t&&(t=A),function(e){var r;return r=e,function(){return{sum:0,push:function(t){return isNaN(parseFloat(t[r]))?void 0:this.sum+=parseFloat(t[r])},value:function(){return this.sum},format:t,numInputs:null!=r?0:1}}}},min:function(t){return null==t&&(t=A),function(e){var r;return r=e,function(){return{val:null,push:function(t){var e,n;return n=parseFloat(t[r]),isNaN(n)?void 0:this.val=Math.min(n,null!=(e=this.val)?e:n)},value:function(){return this.val},format:t,numInputs:null!=r?0:1}}}},max:function(t){return null==t&&(t=A),function(e){var r;return r=e,function(){return{val:null,push:function(t){var e,n;return n=parseFloat(t[r]),isNaN(n)?void 0:this.val=Math.max(n,null!=(e=this.val)?e:n)},value:function(){return this.val},format:t,numInputs:null!=r?0:1}}}},average:function(t){return null==t&&(t=A),function(e){var r;return r=e,function(){return{sum:0,len:0,push:function(t){return isNaN(parseFloat(t[r]))?void 0:(this.sum+=parseFloat(t[r]),this.len++)},value:function(){return this.sum/this.len},format:t,numInputs:null!=r?0:1}}}},median:function(t){return null==t&&(t=A),function(e){var r;return r=e,function(){return{len:0,values:[],push:function(t){return this.values.push(t[r]),this.len++},value:function(){return this.values.sort(),this.values[Math.floor(this.len/2)]},format:t,numInputs:null!=r?0:1}}}},sumOverSum:function(t){return null==t&&(t=A),function(e){var r,n;return n=e[0],r=e[1],function(){return{sumNum:0,sumDenom:0,push:function(t){return isNaN(parseFloat(t[n]))||(this.sumNum+=parseFloat(t[n])),isNaN(parseFloat(t[r]))?void 0:this.sumDenom+=parseFloat(t[r])},value:function(){return this.sumNum/this.sumDenom},format:t,numInputs:null!=n&&null!=r?0:2}}}},sumOverSumBound80:function(t,e){return null==t&&(t=!0),null==e&&(e=A),function(r){var n,a;return a=r[0],n=r[1],function(){return{sumNum:0,sumDenom:0,push:function(t){return isNaN(parseFloat(t[a]))||(this.sumNum+=parseFloat(t[a])),isNaN(parseFloat(t[n]))?void 0:this.sumDenom+=parseFloat(t[n])},value:function(){var e;return e=t?1:-1,(.821187207574908/this.sumDenom+this.sumNum/this.sumDenom+1.2815515655446004*e*Math.sqrt(.410593603787454/(this.sumDenom*this.sumDenom)+this.sumNum*(1-this.sumNum/this.sumDenom)/(this.sumDenom*this.sumDenom)))/(1+1.642374415149816/this.sumDenom)},format:e,numInputs:null!=a&&null!=n?0:2}}}},fractionOf:function(e,n,a){return null==n&&(n="total"),null==a&&(a=C),function(i){var s;return s=1<=arguments.length?r.call(arguments,0):[],function(r,o,l){return{selector:{total:[[],[]],row:[o,[]],col:[[],l]}[n],inner:e.apply(null,s)(r,o,l),push:function(t){return this.inner.push(t)},format:a,value:function(){var e=t.inArray(i,r.valAttrs);return this.selector.push(e),this.inner.value()/r.getAggregator.apply(r,this.selector).inner.value()},numInputs:e.apply(null,s)().numInputs}}}}},l=function(t){return{Count:t.count(y),"Count Unique Values":t.countUnique(y),"List Unique Values":t.listUnique(", "),Sum:t.sum(A),"Integer Sum":t.sum(y),Mean:t.average(A),Median:t.median(A),Minimum:t.min(A),Maximum:t.max(A),"Sum as Fraction of Total":t.fractionOf(t.sum(),"total",C),"Sum as Fraction of Rows":t.fractionOf(t.sum(),"row",C),"Sum as Fraction of Columns":t.fractionOf(t.sum(),"col",C),"Count as Fraction of Total":t.fractionOf(t.count(),"total",C),"Count as Fraction of Rows":t.fractionOf(t.count(),"row",C),"Count as Fraction of Columns":t.fractionOf(t.count(),"col",C)}}(o),m={Table:function(t,e){return g(t,e)},"Table Barchart":function(e,r){return t(g(e,r)).barchart()},Heatmap:function(e,r){return t(g(e,r)).heatmap()},"Row Heatmap":function(e,r){return t(g(e,r)).heatmap("rowheatmap")},"Col Heatmap":function(e,r){return t(g(e,r)).heatmap("colheatmap")}},d={en:{aggregators:l,renderers:m,localeStrings:{renderError:"An error occurred rendering the PivotTable results.",computeError:"An error occurred computing the PivotTable results.",uiRenderError:"An error occurred rendering the PivotTable UI.",selectAll:"Select All",selectNone:"Select None",tooMany:"(too many to list)",filterResults:"Filter results",totals:"Totals",vs:"vs",by:"by"}}},h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],u=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],x=function(t){return("0"+t).substr(-2,2)},c={bin:function(t,e){return function(r){return r[t]-r[t]%e}},dateFormat:function(t,e,r,n,a){var i;return null==r&&(r=!1),null==n&&(n=h),null==a&&(a=u),i=r?"UTC":"",function(r){var s;return s=new Date(Date.parse(r[t])),isNaN(s)?"":e.replace(/%(.)/g,function(t,e){switch(e){case"y":return s["get"+i+"FullYear"]();case"m":return x(s["get"+i+"Month"]()+1);case"n":return n[s["get"+i+"Month"]()];case"d":return x(s["get"+i+"Date"]());case"w":return a[s["get"+i+"Day"]()];case"x":return s["get"+i+"Day"]();case"H":return x(s["get"+i+"Hours"]());case"M":return x(s["get"+i+"Minutes"]());case"S":return x(s["get"+i+"Seconds"]());default:return"%"+e}})}}},f=function(){return function(t,e){var r,n,a,i,s,o,l;if(o=/(\d+)|(\D+)/g,s=/\d/,l=/^0/,"number"==typeof t||"number"==typeof e)return isNaN(t)?1:isNaN(e)?-1:t-e;if(r=String(t).toLowerCase(),a=String(e).toLowerCase(),r===a)return 0;if(!s.test(r)||!s.test(a))return r>a?1:-1;for(r=r.match(o),a=a.match(o);r.length&&a.length;)if(n=r.shift(),i=a.shift(),n!==i)return s.test(n)&&s.test(i)?n.replace(l,".0")-i.replace(l,".0"):n>i?1:-1;return r.length-a.length}}(this),valueSort=function(e){return function(r,n){var a,i;return a=t.inArray(r,e.valAttrs),i=t.inArray(n,e.valAttrs),a-i}}(this),b=function(t){var e,r,n;r={};for(e in t)n=t[e],r[n]=e;return function(t,e){return null!=r[t]&&null!=r[e]?r[t]-r[e]:null!=r[t]?-1:null!=r[e]?1:f(t,e)}},p=function(e,r){var n;return n=e(r),t.isFunction(n)?n:f},t.pivotUtilities={aggregatorTemplates:o,aggregators:l,renderers:m,derivers:c,locales:d,naturalSort:f,numberFormat:v,sortAs:b},i=function(){function e(t,r){if(this.getAggregator=n(this.getAggregator,this),this.getRowKeys=n(this.getRowKeys,this),this.getColKeys=n(this.getColKeys,this),this.sortKeys=n(this.sortKeys,this),this.arrSort=n(this.arrSort,this),this.aggregator=r.aggregator,this.aggregatorName=r.aggregatorName,this.colAttrs=r.cols,this.rowAttrs=r.rows,this.valAttrs=r.vals,this.valLabel=r.valueLabels,this.hideVals=r.hideVals,this.sorters=r.sorters,this.sortedAttrs=r.sortedAttrs,this.tree=[this.aggregatorName.length],this.rowKeys=[],this.displayRowKeys=[],this.colKeys=[],this.displayColKeys=[],this.rowTotals=[],this.colTotals=[],this.allTotal=[],0===this.aggregatorName.length)this.allTotal[0]=this.aggregator[0](this,[],[]),this.rowTotals[0]={},this.colTotals[0]={},this.tree[0]={};else for(var a=0;a<this.aggregatorName.length;a++)this.allTotal[a]=this.aggregator[a](this,[],[]),this.rowTotals[a]={},this.colTotals[a]={},this.tree[a]={};this.sorted=!1,e.forEachRecord(t,r.derivedAttributes,function(t){return function(e){return r.filter(e)?(t.valAttrs.forEach(function(n,a){t.processRecord(e,r.aggregatorName,a)}),!0):void 0}}(this))}return e.forEachRecord=function(e,r,n){var i,s,o,l,u,c,p,d,h,f,v,g;if(i=t.isEmptyObject(r)?n:function(t){var e,a,i;for(e in r)i=r[e],t[e]=null!=(a=i(t))?a:t[e];return n(t)},t.isFunction(e))return e(i);if(t.isArray(e)){if(t.isArray(e[0])){f=[];for(o in e)if(a.call(e,o)&&(s=e[o],o>0)){d={},h=e[0];for(l in h)a.call(h,l)&&(u=h[l],d[u]=s[l]);f.push(i(d))}return f}for(v=[],c=0,p=e.length;p>c;c++)d=e[c],v.push(i(d));return v}if(e instanceof jQuery)return g=[],t("thead > tr > th",e).each(function(){return g.push(t(this).text())}),t("tbody > tr",e).each(function(){return d={},t("td",this).each(function(e){return d[g[e]]=t(this).html()}),i(d)});throw new Error("unknown input format")},e.convertToArray=function(t){var r;return r=[],e.forEachRecord(t,{},function(t){return r.push(t)}),r},e.prototype.arrSort=function(t,e){var r,n;return e=e||[],n=function(){var e,n,a;for(a=[],e=0,n=t.length;n>e;e++)r=t[e],a.push("Values"!=r?p(this.sorters,r):valueSort);return a}.call(this),function(r,a){var i,s,o;for(s in n)if(o=n[s],i=e.hasOwnProperty(t[s])?o(e[t[s]].indexOf(r[s]),e[t[s]].indexOf(a[s])):o(r[s],a[s]),0!==i)return i;return 0}},e.prototype.sortKeys=function(){return this.sorted?void 0:(this.sorted=!0,this.displayRowKeys.sort(this.arrSort(this.rowAttrs,this.sortedAttrs)),!0)},e.prototype.getColKeys=function(){return this.sortKeys(),this.colKeys},e.prototype.getRowKeys=function(){return this.sortKeys(),this.rowKeys},e.prototype.getColDisplayKeys=function(){return this.sortKeys(),this.displayColKeys},e.prototype.getRowDisplayKeys=function(){return this.sortKeys(),this.displayRowKeys},e.prototype.getValueIndex=function(e,r){var n=e.map(function(e){return t.inArray(e,this.valAttrs)}).filter(function(t){return t>-1})[0];return"undefined"==typeof n&&(n=r.map(function(e){return t.inArray(e,this.valAttrs)}).filter(function(t){return t>-1})[0]),"undefined"==typeof n&&(n=-1),n},e.prototype.processRecord=function(e,r,n){var a,i,s,o,l,u,c,p,d,h,f,v,g,m;for(a=[],g=[],d=this.colAttrs,f=this.rowAttrs,i=this.valAttrs,l=0,u=d.length;u>l;l++)m=d[l],a.push("Values"!=m?null!=(h=e[m])?h:"null":this.valAttrs[n]);for(p=0,c=f.length;c>p;p++)m=f[p],g.push("Values"!=m?null!=(v=e[m])?v:"null":this.valAttrs[n]);if(o=g.join(String.fromCharCode(0)),s=a.join(String.fromCharCode(0)),this.allTotal[n].push(e,0,this.valAttrs[n]),0!==g.length){if(!this.rowTotals[n][o]){if(-1==t.inArray(g,this.rowKeys)||"row"==this.valLabel){var b=this.rowKeys.map(function(e){var r=e.map(function(e){return t.inArray(e,i)}).filter(function(t){return t>-1}).length>0;return r});if(0==n||b.filter(function(t){return t}).length>0){this.rowKeys.push(g);var A=!0;this.hideVals.forEach(function(e){t.inArray(e,g)>-1&&(A=!1)}),A&&this.displayRowKeys.push(g)}}this.rowTotals[n][o]=this.aggregator[n](this,g,[])}this.rowTotals[n][o].push(e)}if(0!==a.length){if(!this.colTotals[n][s]){if(-1==t.inArray(a,this.colKeys)||"col"==this.valLabel)var b=this.colKeys.map(function(e){var r=e.map(function(e){return t.inArray(e,i)}).filter(function(t){return t>-1}).length>0;return r});if(0==n||b.filter(function(t){return t}).length>0){this.colKeys.push(a);var A=!0;this.hideVals.forEach(function(e){t.inArray(e,a)>-1&&(A=!1)}),A&&this.displayColKeys.push(a)}this.colTotals[n][s]=this.aggregator[n](this,[],a)}this.colTotals[n][s].push(e)}0!==a.length&&0!==g.length&&(this.tree[n][o]||(this.tree[n][o]={}),this.tree[n][o][s]||(this.tree[n][o][s]=this.aggregator[n](this,g,a)),this.tree[n][o][s].push(e))},e.prototype.getAggregator=function(t,e,r){var n,a,i;return i=t.join(String.fromCharCode(0)),a=e.join(String.fromCharCode(0)),n=0===t.length&&0===e.length?this.allTotal[r]:0===t.length?this.colTotals[r][a]:0===e.length?this.rowTotals[r][i]:this.tree[r][i][a],null!=n?n:{value:function(){return null},format:function(){return""}}},e}(),g=function(e,r){var n,i,s,o,l,u,c,p,d,h,f,v,g,m,b,A,y,C,x,T,w;u={localeStrings:{totals:"Totals"}},r=t.extend(u,r),s=e.colAttrs,f=e.rowAttrs,valAttrs=e.valAttrs,valLabel=e.valLabel,g=e.getRowKeys(),l=e.getColKeys(),h=t("<table></table>"),h.addClass("pvtTable"),l=e.displayColKeys,g=e.displayRowKeys,m=function(t,e,r){var n,a,i,s,o,l,u,c;if(0!==e){for(s=!0,c=n=0,o=r;o>=0?o>=n:n>=o;c=o>=0?++n:--n)t[e-1][c]!==t[e][c]&&(s=!1);if(s)return-1}for(a=0;e+a<t.length;){for(u=!1,c=i=0,l=r;l>=0?l>=i:i>=l;c=l>=0?++i:--i)t[e][c]!==t[e+a][c]&&(u=!0);if(u)break;a++}return a};for(p in s)if(a.call(s,p)){i=s[p],C=document.createElement("tr"),C.setAttribute("colLabels",p);for(k in f)A=document.createElement("th"),t(A).addClass("pvtAxisLabel"),t(A).attr("colspan",1),p==s.length-1&&t(A).text(f[k]),k==f.length-1&&t(A).text(i),C.appendChild(A);for(c in l)a.call(l,c)&&(o=l[c],w=m(l,parseInt(c),parseInt(p)),-1!==w&&(A=document.createElement("th"),A.className="pvtColLabel",A.innerHTML=o[p],A.setAttribute("colspan",w),A.setAttribute("pvt-header",i),parseInt(p)===s.length-1&&0!==f.length&&A.setAttribute("rowspan",1),t(A).mouseover(function(){var e=t(this).attr("pvt-header");t(this).prev().hasClass("pvtAxisLabel")?t(this).prev().css({visibility:"visible","border-radius":"5px 0px 0px 5px"}).text(e):t(this).prevUntil(".pvtAxisLabel").last().prev().css("visibility","visible").text(e)}).mouseout(function(){t(this).prev().hasClass("pvtAxisLabel")?t(this).prev().css("visibility","hidden"):t(this).prevUntil(".pvtAxisLabel").last().prev().css("visibility","hidden")}),C.appendChild(A)));if(0===parseInt(p)){A=document.createElement("th"),A.className="pvtTotalLabel rowTotal",A.innerHTML=r.localeStrings.totals;var L="col"==valLabel?2:1;A.setAttribute("rowspan",s.length+(0===f.length?0:1)-L),A.setAttribute("colspan",valAttrs.length),C.appendChild(A)}h.append(C)}if(0!==f.length){C=document.createElement("tr"),C.setAttribute("rowlabels",!0);for(c in f)a.call(f,c)&&(d=f[c],A=document.createElement("th"),A.className="pvtAxisLabel",A.innerHTML=d,C.appendChild(A));"col"==valLabel&&(lastColLabel=t(h).find("[collabels]").last(),valAttrs.forEach(function(e){A=t("<th></th>"),A.text(e),A.addClass("pvtTotalLabel rowTotal"),lastColLabel.append(A)}))}else{var N=s.length-1;lastColLabel=t(h).find('[collabels="'+N+'"]'),valAttrs.forEach(function(e){A=t("<th></th>"),A.text(e),A.addClass("pvtTotalLabel rowTotal"),lastColLabel.append(A)})}for(c in g)if(a.call(g,c)){v=g[c],C=document.createElement("tr");for(p in v)a.call(v,p)&&(x=v[p],w=m(g,parseInt(c),parseInt(p)),-1!==w&&(A=document.createElement("th"),A.className="pvtRowLabel",A.innerHTML=x,A.setAttribute("rowspan",w),A.setAttribute("pvt-header",f[p]),A.setAttribute("row-index",p),parseInt(p)===f.length-1&&0!==s.length&&A.setAttribute("colspan",1),t(A).mouseover(function(){var e=t(this).attr("pvt-header"),r=t(t(this).parents("tbody").find("[collabels]").last().children()[t(this).attr("row-index")]);r.css({visibility:"visible","border-radius":"5px 5px 0px 0px"}).text(e)}).mouseout(function(){var e=t(t(this).parents("tbody").find("[collabels]").last().children()[t(this).attr("row-index")]);e.css("visibility","hidden")}),C.appendChild(A)));for(p in l)if(a.call(l,p)){o=l[p];var S=e.getValueIndex(o,v);n=e.getAggregator(v,o,S),T=n.value(),b=document.createElement("td"),b.className="pvtVal row"+c+" col"+p,b.innerHTML=n.format(T),b.setAttribute("data-value",T),b.setAttribute("value-index",S),C.appendChild(b)}if("col"==valLabel)valAttrs.forEach(function(t,r){y=e.getAggregator(v,[],r),T=y.value(),b=document.createElement("td"),b.className="pvtTotal rowTotal",b.innerHTML=y.format(T),b.setAttribute("data-value",T),b.setAttribute("data-for","row"+c),C.appendChild(b)});else{var S=e.getValueIndex(o,v);y=e.getAggregator(v,[],S),T=y.value(),b=document.createElement("td"),b.className="pvtTotal rowTotal",b.innerHTML=y.format(T),b.setAttribute("data-value",T),b.setAttribute("data-for","row"+c),C.appendChild(b)}h.append(C)}C=document.createElement("tr"),A=document.createElement("th"),A.className="pvtTotalLabel colTotal",A.innerHTML=r.localeStrings.totals,A.setAttribute("rowspan",valAttrs.length);var L="row"==valLabel?2:1;if(A.setAttribute("colspan",f.length+(0===s.length?0:1)-L),C.appendChild(A),"col"==valLabel){for(p in l)if(a.call(l,p)){o=l[p];var S=e.getValueIndex(o,v);y=e.getAggregator([],o,S),T=y.value(),b=document.createElement("td"),b.className="pvtTotal colTotal",b.innerHTML=y.format(T),b.setAttribute("data-value",T),b.setAttribute("data-for","col"+p),C.appendChild(b)}valAttrs.forEach(function(t,r){y=e.getAggregator([],[],r),T=y.value(),b=document.createElement("td"),b.className="pvtGrandTotal",b.innerHTML=y.format(T),b.setAttribute("data-value",T),C.appendChild(b)})}else valAttrs.forEach(function(t,r){r>0&&(h.append(C),C=document.createElement("tr")),A=document.createElement("th"),A.innerHTML=t,A.className="pvtTotalLabel colTotal",C.appendChild(A);for(p in l)a.call(l,p)&&(o=l[p],y=e.getAggregator([],o,r),T=y.value(),b=document.createElement("td"),b.className="pvtTotal colTotal",b.innerHTML=y.format(T),b.setAttribute("data-value",T),b.setAttribute("data-for","col"+p),C.appendChild(b));y=e.getAggregator([],[],r),T=y.value(),b=document.createElement("td"),b.className="pvtGrandTotal",b.innerHTML=y.format(T),b.setAttribute("data-value",T),C.appendChild(b)});h.append(C),"col"==valLabel&&1==s.length?t(h).find(".rowTotal, .pvtGrandTotal").hide():"row"==valLabel&&1==f.length?t(h).find(".colTotal, .pvtGrandTotal").hide():"col"==valLabel&&0==f.length&&t(h).find(".pvtTotalLabel.colTotal").hide(),h.attr("data-numrows",g.length),h.attr("data-numcols",l.length);var V=t('<div class="pvtToolbar"><div>');return V.append(t("<i></i>").addClass("fa fa-cog pvtControl").click(function(){pvtUI=t(this).parents(".pvtUi"),"none"==pvtUI.find(".pvtAxisContainer").css("display")?pvtUI.find(".pvtAxisContainer, .pvtVals, .pvtRenderer").show():pvtUI.find(".pvtAxisContainer, .pvtVals, .pvtRenderer").hide()})),h.prepend(V),h},t.fn.pivot=function(e,r){var n,a,s,l,u;n={cols:[],rows:[],vals:[],filter:function(){return!0},aggregator:o.count()(),aggregatorName:"Count",sorters:function(){},derivedAttributes:{},renderer:g,rendererOptions:null,localeStrings:d.en.localeStrings},r=t.extend(n,r),l=null;try{s=new i(e,r);try{l=r.renderer(s,r.rendererOptions)}catch(c){a=c,"undefined"!=typeof console&&null!==console&&console.error(a.stack),l=t("<span>").html(r.localeStrings.renderError)}}catch(c){a=c,"undefined"!=typeof console&&null!==console&&console.error(a.stack),l=t("<span>").html(r.localeStrings.computeError)}for(u=this[0];u.hasChildNodes();)u.removeChild(u.lastChild);return this.append(l)},t.fn.pivotUI=function(r,n,s,o){var l,u,c,h,v,g,m,b,A,y,C,x,T,w,L,N,S,V,E,I,F,D,M,R,K,k,U,O,H,q,j,P,B,z,G,_,J,Q,Z,$;null==s&&(s=!0),null==o&&(o="en"),null==d[o]&&(o="en"),m={derivedAttributes:{},aggregators:d[o].aggregators,renderers:d[o].renderers,hiddenAttributes:[],menuLimit:200,cols:[],rows:[],vals:[],hideVals:[],valueCol:!1,sortedAttrs:{},exclusions:{},inclusions:{},unusedAttrsVertical:85,autoSortUnusedAttrs:!1,rendererOptions:{localeStrings:d[o].localeStrings},onRefresh:null,filter:function(){return!0},sorters:function(){},localeStrings:d[o].localeStrings},A=this.data("pivotUIOptions"),F=null==A||s?t.extend(m,n):A;try{r=i.convertToArray(r),z=function(){var t,e;t=r[0],e=[];for(T in t)a.call(t,T)&&e.push(T);return e}(),R=F.derivedAttributes;for(v in R)a.call(R,v)&&e.call(z,v)<0&&z.push(v);for(h={},w=0,L=z.length;L>w;w++)$=z[w],h[$]={};i.forEachRecord(r,F.derivedAttributes,function(t){var e,r,n;r=[];for(T in t)a.call(t,T)&&(n=t[T],F.filter(t)&&(null==n&&(n="null"),null==(e=h[T])[n]&&(e[n]=0),r.push(h[T][n]++)));return r}),J=t("<table>",{"class":"pvtUi"}).attr("cellpadding",5),P=t("<td>"),j=t("<select>").addClass("pvtRenderer").appendTo(P).bind("change",function(){return H()}),K=F.renderers;for($ in K)a.call(K,$)&&t("<option>").val($).html($).appendTo(j);if(g=t("<td>").addClass("pvtAxisContainer pvtUnused"),B=function(){var t,r,n;for(n=[],r=0,t=z.length;t>r;r++)v=z[r],e.call(F.hiddenAttributes,v)<0&&n.push(v);return n}(),Z=!1,Q="auto"===F.unusedAttrsVertical?120:parseInt(F.unusedAttrsVertical),!isNaN(Q)){for(c=0,E=0,N=B.length;N>E;E++)l=B[E],c+=l.length;Z=c>Q}g.addClass(F.unusedAttrsVertical===!0||Z?"pvtVertList":"pvtHorizList"),y=function(r){var n,a,i,s,o,l,u,c,d,f,v,m,b,A,y;if(u=function(){var t;t=[];for(T in h[r])t.push(T);return t}(),l=!1,y=t("<div>").addClass("pvtFilterBox").hide(),y.append(t("<h4>").text(r+" ("+u.length+")")),u.length>F.menuLimit)y.append(t("<p>").html(F.localeStrings.tooMany));else for(a=t("<p>").appendTo(y),a.append(t("<i>").addClass("fa fa-check-square-o pvtControl").css({"font-size":"20px","margin-right":"5px"}).bind("click",function(){return y.find("input:visible").prop("checked",!0)})),a.append(t("<i>").addClass("fa fa-times-circle pvtControl").css({"font-size":"20px","margin-right":"10px"}).bind("click",function(){return y.find("input:visible").prop("checked",!1)})),a.append(t("<input>",{type:"text",placeholder:F.localeStrings.filterResults,"class":"pvtSearch"}).bind("keyup",function(){var e;return e=t(this).val().toLowerCase(),y.find(".pvtCheckContainer p").each(function(){var r;return r=t(this).text().toLowerCase().indexOf(e),-1!==r?t(this).show():t(this).hide()})})),i=t("<div>").addClass("pvtCheckContainer").appendTo(y),f=u.sort(p(F.sorters,r)),d=0,c=f.length;c>d;d++)T=f[d],A=h[r][T],s=t("<label>"),o=!1,F.inclusions[r]?o=e.call(F.inclusions[r],T)<0:F.exclusions[r]&&(o=e.call(F.exclusions[r],T)>=0),l||(l=o),t("<input>").attr("type","checkbox").addClass("pvtFilter").attr("checked",!o).data("filter",[r,T]).appendTo(s),s.append(t("<span>").html(T)),i.append(t("<p>").append(s));return b=function(){var t;return t=y.find("[type='checkbox']").length-y.find("[type='checkbox']:checked").length,t>0?n.addClass("pvtFilteredAttribute"):n.removeClass("pvtFilteredAttribute"),u.length>F.menuLimit?y.toggle():y.toggle(0,H)},t("<p>").appendTo(y).append(t("<i>").addClass("fa fa-2x fa-check pvtControl").bind("click",b)),v=function(e){var r,n,a;return a=t(e.currentTarget).position(),r=a.left,n=a.top,y.css({left:r+10,top:n+10}).toggle(),y.find(".pvtSearch").val(""),y.find(".pvtCheckContainer p").show()},m=t("<span>").addClass("pvtTriangle").html(" &#x25BE;").bind("click",v),n=t("<li>").addClass("pvtDragLabel axis_"+C).append(t("<span>").addClass("pvtAttr").text(r).data("attrName",r).append(m)),l&&n.addClass("pvtFilteredAttribute"),-1==t.inArray(r,F.vals)&&g.append(n).append(y),n.bind("dblclick",v)};for(C in B)a.call(B,C)&&(v=B[C],y(v));G=t("<tr>").appendTo(J),u=t("<select>").addClass("pvtAggregator").bind("change",function(){return H()}),k=F.aggregators;for($ in k)a.call(k,$)&&u.append(t("<option>").val($).html($));for(t("<td>").addClass("pvtVals").appendTo(G),t("<td>").addClass("pvtAxisContainer pvtHorizList pvtCols").appendTo(G),_=t("<tr>").appendTo(J),_.append(t("<td>").addClass("pvtAxisContainer pvtRows").attr("valign","top")),D=t("<td>").attr("valign","top").addClass("pvtRendererArea").appendTo(_),F.unusedAttrsVertical===!0||Z?(J.find("tr:nth-child(1)").prepend(P),J.find("tr:nth-child(2)").prepend(g)):J.prepend(t("<tr>").append(P).append(g)),this.html(J),U=F.cols,I=0,S=U.length;S>I;I++)$=U[I],this.find(".pvtCols").append(this.find(".axis_"+t.inArray($,B)));for(O=F.rows,M=0,V=O.length;V>M;M++)$=O[M],this.find(".pvtRows").append(this.find(".axis_"+t.inArray($,B)));null!=F.rendererName&&this.find(".pvtRenderer").val(F.rendererName),x=!0,q=function(n){return function(){var a,i,s,o,l,c,p,d;c={derivedAttributes:F.derivedAttributes,localeStrings:F.localeStrings,rendererOptions:F.rendererOptions,sorters:F.sorters,cols:[],rows:[],hideVals:[],sortedAttrs:F.sortedAttrs},0==n.find(".pvtValueLabel").length&&(valueLabel=t("<li>").addClass("pvtValueLabel pvtDragLabel").append(t("<span>").addClass("pvtAttr").text("Values").data("attrName","Values")),F.valueCol?t(".pvtAxisContainer.pvtCols").append(valueLabel):t(".pvtAxisContainer.pvtRows").append(valueLabel)),s=null!=(l=F.aggregators[u.val()]([])().numInputs)?l:0,d=[],n.find(".pvtRows li span.pvtAttr").each(function(){return c.rows.push(t(this).data("attrName"))}),n.find(".pvtCols li span.pvtAttr").each(function(){return c.cols.push(t(this).data("attrName"))}),n.find(".pvtVals select.pvtAttrDropdown").each(function(){return 0===s?t(this).remove():(s--,""!==t(this).val()?d.push(t(this).val()):void 0)});var h=[];return n.find(".pvtVals .toggleVal.hideVal").each(function(){h.push(t(this).next().text())}),c.hideVals=h,x&&(d=F.vals,c.hideVals=F.hideVals,d.forEach(function(e,r){var a="fa-eye";t.inArray(e,F.hideVals)>-1&&(a="fa-eye-slash");var i=t("<li>").addClass("axis_"+r).append(t("<i></i>").addClass("toggleVal fa "+a).click(function(){t(this).hasClass("fa-eye")?t(this).removeClass("fa-eye showVal").addClass("fa-eye-slash hideVal"):t(this).removeClass("fa-eye-slash hideVal").addClass("fa-eye showVal"),H()})).append(t("<span>").addClass("pvtAttr").text(e).data("attrName",e));u.clone().appendTo(i).change(function(){return H()}),null!=F.aggregatorName&&i.find(".pvtAggregator").val(F.aggregatorName),n.find(".pvtVals").append(i)}),C=0,n.find(".pvtVals select.pvtAttrDropdown").each(function(){return t(this).val(d[C]),C++}),x=!1),c.aggregatorName=[],n.find(".pvtAggregator").each(function(){c.aggregatorName.push(t(this).val())}),d=[],n.find(".pvtVals .pvtAttr").each(function(){d.push(t(this).text())}),c.vals=d,c.aggregator=[],c.aggregatorName.forEach(function(t,e){c.aggregator.push(F.aggregators[t](d[e]))}),c.valueLabels="",n.find(".pvtValueLabel").parents(".pvtAxisContainer").hasClass("pvtCols")?c.valueLabels="col":n.find(".pvtValueLabel").parents(".pvtAxisContainer").hasClass("pvtRows")?c.valueLabels="row":n.find(".pvtValueLabel").parents(".pvtAxisContainer").hasClass("pvtUnused")&&(c.valueLabels="unused"),c.renderer=F.renderers[j.val()],a={},n.find("input.pvtFilter").not(":checked").each(function(){var e;return e=t(this).data("filter"),null!=a[e[0]]?a[e[0]].push(e[1]):a[e[0]]=[e[1]]}),i={},n.find("input.pvtFilter:checked").each(function(){var e;return e=t(this).data("filter"),null!=a[e[0]]?null!=i[e[0]]?i[e[0]].push(e[1]):i[e[0]]=[e[1]]:void 0}),c.filter=function(t){var r,n;if(!F.filter(t))return!1;for(T in a)if(r=a[T],n=""+t[T],e.call(r,n)>=0)return!1;return!0},D.pivot(r,c),o=t.extend(F,{cols:c.cols,rows:c.rows,vals:d,exclusions:a,inclusions:i,inclusionsInfo:i,aggregatorName:u.val(),rendererName:j.val()}),n.data("pivotUIOptions",o),F.autoSortUnusedAttrs&&(p=n.find("td.pvtUnused.pvtAxisContainer"),t(p).children("li").sort(function(e,r){return f(t(e).text(),t(r).text())}).appendTo(p)),D.css("opacity",1),null!=F.onRefresh?F.onRefresh(o):void 0}}(this),H=function(){return function(){return D.css("opacity",.5),setTimeout(q,10)}}(this),H(),interact(".pvtDragLabel").draggable({onmove:function(t){obieeUI.basicDrag(t)},onend:obieeUI.snapBack}),interact(".pvtAxisContainer").dropzone({accept:".pvtDragLabel",overlap:"pointer",ondragenter:function(e){t(e.target).hasClass("pvtUnused")?obieeUI.dragEnter(e):0==t(e.target).children("li").length&&obieeUI.dragEnter(e)},ondragleave:function(t){obieeUI.dragLeave(t)},ondrop:function(e){t(e.target).hasClass("pvtUnused")?t(e.target).append(t(e.relatedTarget)):0==t(e.target).children("li").length&&t(e.target).append(t(e.relatedTarget)),H()},ondropdeactivate:obieeUI.dropDeactivate}),interact(".pvtDragLabel").dropzone({accept:".pvtDragLabel",overlap:"pointer",ondragenter:function(e){var r,n=t('<li class="pvtPlaceholder"></li>');r=t(e.target).parent().hasClass("pvtCols")?e.dragEvent.dx:e.dragEvent.dy,r>=0?n.insertAfter(t(e.target)):n.insertBefore(t(e.target))},ondragleave:function(e){t(e.target).parent().find(".pvtPlaceholder").remove()},ondrop:function(e){t(e.target).parent().find(".pvtPlaceholder").remove();var r;r=t(e.target).parent().hasClass("pvtCols")?e.dragEvent.dx:e.dragEvent.dy,r>=0?t(e.relatedTarget).insertAfter(t(e.target)):t(e.relatedTarget).insertBefore(t(e.target)),H()},ondropdeactivate:obieeUI.dropDeactivate})}catch(W){b=W,"undefined"!=typeof console&&null!==console&&console.error(b.stack),this.html(F.localeStrings.uiRenderError)}return this},t.fn.heatmap=function(e){var r,n,a,i,s,o,l,u,c,p;switch(null==e&&(e="heatmap"),u=this.data("numrows"),l=this.data("numcols"),r=function(t,e,r){var n;return n=function(){switch(t){case"red":return function(t){return"ff"+t+t};case"green":return function(t){return t+"ff"+t};case"blue":return function(t){return""+t+t+"ff"}}}(),function(t){var a,i;return i=255-Math.round(255*(t-e)/(r-e)),a=i.toString(16).split(".")[0],1===a.length&&(a=0+a),n(a)}},n=function(e){return function(n,a){var i,s,o;return s=function(r){return e.find(n).each(function(){var e;return e=t(this).data("value"),null!=e&&isFinite(e)?r(e,t(this)):void 0})},o=[],s(function(t){return o.push(t)}),i=r(a,Math.min.apply(Math,o),Math.max.apply(Math,o)),s(function(t,e){return e.css("background-color","#"+i(t))})}}(this),e){case"heatmap":n(".pvtVal","red");break;case"rowheatmap":for(a=s=0,c=u;c>=0?c>s:s>c;a=c>=0?++s:--s)n(".pvtVal.row"+a,"red");break;case"colheatmap":for(i=o=0,p=l;p>=0?p>o:o>p;i=p>=0?++o:--o)n(".pvtVal.col"+i,"red")}return n(".pvtTotal.rowTotal","red"),n(".pvtTotal.colTotal","red"),this},t.fn.barchart=function(){var e,r,n,a,i,s;for(i=this.data("numrows"),a=this.data("numcols"),e=function(e){return function(r){var n,a,i,s;return n=function(n){return e.find(r).each(function(){var e;return e=t(this).data("value"),null!=e&&isFinite(e)?n(e,t(this)):void 0})},s=[],n(function(t){return s.push(t)}),a=Math.max.apply(Math,s),i=function(t){return 100*t/(1.4*a)},n(function(e,r){var n,a;return n=r.text(),a=t("<div>").css({position:"relative",height:"55px"}),a.append(t("<div>").css({position:"absolute",bottom:0,left:0,right:0,height:i(e)+"%","background-color":"gray"})),a.append(t("<div>").text(n).css({position:"relative","padding-left":"5px","padding-right":"5px"})),r.css({padding:0,"padding-top":"5px","text-align":"center"}).html(a)})}}(this),r=n=0,s=i;s>=0?s>n:n>s;r=s>=0?++n:--n)e(".pvtVal.row"+r);return e(".pvtTotal.colTotal"),this}})}).call(this);